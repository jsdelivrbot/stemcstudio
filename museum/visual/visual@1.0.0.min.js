var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},visual;!function(a){var b=function(a){function b(b,c,d,e,f,g){a.call(this),d=d||12,e=e||0,f=f||2*Math.PI;var h,i,j,k,l=Math.abs(2*Math.PI-Math.abs(f-e))<1e-4,m=l?d:d+1,n=1/d,o=(f-e)*n;for(h=0,j=m;j>h;h++){var p=e+h*o,q=p/2,r=Math.cos(q),s=Math.sin(q),t=new THREE.Quaternion(c.x*s,c.y*s,c.z*s,r);for(i=0,k=b.length;k>i;i++){var u=b[i],v=new THREE.Vector3(u.x,u.y,u.z);v.applyQuaternion(t),g&&v.applyQuaternion(g),this.vertices.push(v)}}var w=1/(b.length-1),x=b.length,y=x*m;for(h=0,j=d;j>h;h++)for(i=0,k=b.length-1;k>i;i++){var z=i+x*h,A=z%y,B=(z+x)%y,C=(z+1+x)%y,D=(z+1)%y,E=h*n,F=i*w,G=E+n,H=F+w;this.faces.push(new THREE.Face3(D,B,A)),this.faceVertexUvs[0].push([new THREE.Vector2(E,F),new THREE.Vector2(G,F),new THREE.Vector2(E,H)]),this.faces.push(new THREE.Face3(D,C,B)),this.faceVertexUvs[0].push([new THREE.Vector2(G,F),new THREE.Vector2(G,H),new THREE.Vector2(E,H)])}this.computeFaceNormals(),this.computeVertexNormals()}return __extends(b,a),b}(THREE.Geometry);a.RevolutionGeometry=b}(visual||(visual={}));var visual;!function(a){var b=function(a){function b(b,c,d,e,f,g,h,i){b=b||1,c=c||new THREE.Quaternion(0,0,0,1),e=(e||1)*b,f=(f||.01)*b,g=(g||.08)*b,h=(h||.2)*b,i=i||new THREE.Vector3(0,0,1);var j=e-h,k=e/2,l=function(a){return a.x?2:a.y?1:0},m=function(a){return a.x>0?1:a.x<0?-1:a.y>0?1:a.y<0?-1:a.z>0?1:a.z<0?-1:0},n=function(a){var b=l(a),c=m(a),d=(b+0)%3,e=(b+1)%3,h=(b+2)%3,i=[[0,0,k*c],[g,0,(j-k)*c],[f,0,(j-k)*c],[f,0,-k*c],[0,0,-k*c]],n=i.map(function(a){return new THREE.Vector3(a[d],a[e],a[h])}),o=new THREE.Quaternion(a.x,a.y,a.z,0);return{points:n,generator:o}},o=n(i);a.call(this,o.points,o.generator,d,0,2*Math.PI,c)}return __extends(b,a),b}(a.RevolutionGeometry);a.ArrowGeometry=b}(visual||(visual={}));var visual;!function(a){var b=function(a){function b(b,c){this.geometry=b,this.material=c,a.call(this,b,this.material)}return __extends(b,a),Object.defineProperty(b.prototype,"pos",{get:function(){var a=this.position;return new blade.Euclidean3(0,a.x,a.y,a.z,0,0,0,0)},set:function(a){this.position.set(a.x,a.y,a.z)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"attitude",{get:function(){var a=this.quaternion;return new blade.Euclidean3(a.w,0,0,0,-a.z,-a.x,-a.y,0)},set:function(a){this.quaternion.set(-a.yz,-a.zx,-a.xy,a.w)},enumerable:!0,configurable:!0}),b}(THREE.Mesh);a.Mesh=b}(visual||(visual={}));var visual;!function(a){var b=function(b){function c(c){c=c||{};var d=c.scale||1,e=new THREE.Quaternion(0,0,0,1),f=void 0,g=1*d,h=.01*d,i=.08*d,j=.2*d,k=c.axis||{x:0,y:0,z:1};c.color="number"==typeof c.color?c.color:16777215,c.opacity="number"==typeof c.opacity?c.opacity:1,c.transparent="boolean"==typeof c.transparent?c.transparent:!1;var l=new THREE.MeshLambertMaterial({color:c.color,opacity:c.opacity,transparent:c.transparent});b.call(this,new a.ArrowGeometry(d,e,f,g,h,i,j,k),l)}return __extends(c,b),c}(a.Mesh);a.Arrow=b}(visual||(visual={}));var visual;!function(a){var b=function(a){function b(b){b=b||{},b.width=b.width||1,b.height=b.height||1,b.depth=b.depth||1,b.color="number"==typeof b.color?b.color:16777215,b.opacity="number"==typeof b.opacity?b.opacity:1,b.transparent="boolean"==typeof b.transparent?b.transparent:!1;var c=new THREE.MeshLambertMaterial({color:b.color,opacity:b.opacity,transparent:b.transparent});a.call(this,new THREE.BoxGeometry(b.width,b.height,b.depth),c)}return __extends(b,a),b}(a.Mesh);a.Box=b}(visual||(visual={}));var visual;!function(a){var b=function(a){function b(b){b=b||{},b.radius=b.radius||1,b.color="number"==typeof b.color?b.color:16777215,b.opacity="number"==typeof b.opacity?b.opacity:1,b.transparent="boolean"==typeof b.transparent?b.transparent:!1;var c=new THREE.MeshLambertMaterial({color:b.color,opacity:b.opacity,transparent:b.transparent});a.call(this,new THREE.SphereGeometry(b.radius,b.widthSegments,b.heightSegments,b.phiStart,b.phiLength,b.thetaStart,b.thetaLength),c)}return __extends(b,a),b}(a.Mesh);a.Sphere=b}(visual||(visual={}));var visual;!function(a){function b(a,b){for(var c=a.getElementsByTagName(b),d=c.length-1;d>=0;d--){var e=c[d];e.parentNode.removeChild(e)}}var c=function(){function a(a,b){function c(c){var d=b.innerWidth,e=b.innerHeight;a.width=d,a.height=e}this.canvas=a,this.wnd=b,this.sizer=c}return a.prototype.setUp=function(){this.wnd.document.body.insertBefore(this.canvas,this.wnd.document.body.firstChild),this.wnd.addEventListener("resize",this.sizer,!1),this.sizer(null)},a.prototype.tearDown=function(){this.wnd.removeEventListener("resize",this.sizer,!1),b(this.wnd.document,"canvas")},a}();a.Workbench2D=c}(visual||(visual={}));var visual;!function(a){function b(a,b){for(var c=a.getElementsByTagName(b),d=c.length-1;d>=0;d--){var e=c[d];e.parentNode.removeChild(e)}}var c=function(){function a(a,b,c,d,e){function f(a){var f=e.innerWidth,g=e.innerHeight;b.setSize(f,g),c.aspect=f/g,c.updateProjectionMatrix(),d.handleResize()}this.canvas=a,this.wnd=e,this.sizer=f}return a.prototype.setUp=function(){this.wnd.document.body.insertBefore(this.canvas,this.wnd.document.body.firstChild),this.wnd.addEventListener("resize",this.sizer,!1),this.sizer(null)},a.prototype.tearDown=function(){this.wnd.removeEventListener("resize",this.sizer,!1),b(this.wnd.document,"canvas")},a}();a.Workbench3D=c}(visual||(visual={}));var visual;!function(a){a.trackball=function(a,b){function c(a){o.enabled!==!1&&(b.removeEventListener("keydown",c),A=z,z===y.NONE&&(a.keyCode!==o.keys[y.ROTATE]||o.noRotate?a.keyCode!==o.keys[y.ZOOM]||o.noZoom?a.keyCode!==o.keys[y.PAN]||o.noPan||(z=y.PAN):z=y.ZOOM:z=y.ROTATE))}function d(a){o.enabled!==!1&&(z=A,b.addEventListener("keydown",c,!1))}function e(a){o.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),z===y.NONE&&(z=a.button),z!==y.ROTATE||o.noRotate?z!==y.ZOOM||o.noZoom?z!==y.PAN||o.noPan||(F.copy(p(a.pageX,a.pageY)),G.copy(F)):(B.copy(p(a.pageX,a.pageY)),C.copy(B)):(r.copy(q(a.pageX,a.pageY)),s.copy(r)),l.addEventListener("mousemove",f,!1),l.addEventListener("mouseup",g,!1))}function f(a){o.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),z!==y.ROTATE||o.noRotate?z!==y.ZOOM||o.noZoom?z!==y.PAN||o.noPan||G.copy(p(a.pageX,a.pageY)):C.copy(p(a.pageX,a.pageY)):(s.copy(r),r.copy(q(a.pageX,a.pageY))))}function g(a){o.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),z=y.NONE,l.removeEventListener("mousemove",f),l.removeEventListener("mouseup",g))}function h(a){if(o.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),B.y+=.01*b}}function i(a){if(o.enabled!==!1)switch(a.touches.length){case 1:z=y.TOUCH_ROTATE,r.copy(q(a.touches[0].pageX,a.touches[0].pageY)),s.copy(r);break;case 2:z=y.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;E=D=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;F.copy(p(d,e)),G.copy(F);break;default:z=y.NONE}}function j(a){if(o.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:s.copy(r),r.copy(q(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;E=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;G.copy(p(d,e));break;default:z=y.NONE}}function k(a){if(o.enabled!==!1){switch(a.touches.length){case 1:s.copy(r),r.copy(q(a.touches[0].pageX,a.touches[0].pageY));break;case 2:D=E=0;var b=(a.touches[0].pageX+a.touches[1].pageX)/2,c=(a.touches[0].pageY+a.touches[1].pageY)/2;G.copy(p(b,c)),F.copy(G)}z=y.NONE}}{var l=b.document,m=l.documentElement,n={left:0,top:0,width:0,height:0},o={enabled:!0,rotateSpeed:1,zoomSpeed:1.2,panSpeed:.3,noRotate:!1,noZoom:!1,noPan:!1,staticMoving:!1,dynamicDampingFactor:.2,minDistance:0,maxDistance:1/0,keys:[65,83,68],update:function(){t.subVectors(a.position,u),o.noRotate||x(),o.noZoom||H(),o.noPan||I(),a.position.addVectors(u,t),J(),a.lookAt(u),L.distanceToSquared(a.position)>K&&L.copy(a.position)},handleResize:function(){var a=m.getBoundingClientRect();n.left=a.left+b.pageXOffset-m.clientLeft,n.top=a.top+b.pageYOffset-m.clientTop,n.width=a.width,n.height=a.height}},p=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-n.left)/n.width,(c-n.top)/n.height),a}}(),q=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-.5*n.width-n.left)/(.5*n.width),(n.height+2*(n.top-c))/n.width),a}}(),r=new THREE.Vector2,s=new THREE.Vector2,t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=0,x=function(){var b,c=new THREE.Vector3,d=new THREE.Quaternion,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3;return function(){h.set(r.x-s.x,r.y-s.y,0),b=h.length(),b?(t.copy(a.position).sub(u),e.copy(t).normalize(),f.copy(a.up).normalize(),g.crossVectors(f,e).normalize(),f.setLength(r.y-s.y),g.setLength(r.x-s.x),h.copy(f.add(g)),c.crossVectors(h,t).normalize(),b*=o.rotateSpeed,d.setFromAxisAngle(c,b),t.applyQuaternion(d),a.up.applyQuaternion(d),v.copy(c),w=b):!o.staticMoving&&w&&(w*=Math.sqrt(1-o.dynamicDampingFactor),t.copy(a.position).sub(u),d.setFromAxisAngle(v,w),t.applyQuaternion(d),a.up.applyQuaternion(d)),s.copy(r)}}(),y={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},z=y.NONE,A=y.NONE,B=new THREE.Vector2,C=new THREE.Vector2,D=0,E=0,F=new THREE.Vector2,G=new THREE.Vector2,H=function(){var a;z===y.TOUCH_ZOOM_PAN?(a=D/E,D=E,t.multiplyScalar(a)):(a=1+(C.y-B.y)*o.zoomSpeed,1!==a&&a>0&&(t.multiplyScalar(a),o.staticMoving?B.copy(C):B.y+=(C.y-B.y)*o.dynamicDampingFactor))},I=function(){var b=new THREE.Vector2,c=new THREE.Vector3,d=new THREE.Vector3;return function(){b.copy(G).sub(F),b.lengthSq()&&(b.multiplyScalar(t.length()*o.panSpeed),d.copy(t).cross(a.up).setLength(b.x),d.add(c.copy(a.up).setLength(b.y)),a.position.add(d),u.add(d),o.staticMoving?F.copy(G):F.add(b.subVectors(G,F).multiplyScalar(o.dynamicDampingFactor)))}}(),J=function(){o.noZoom&&o.noPan||(t.lengthSq()>o.maxDistance*o.maxDistance&&a.position.addVectors(u,t.setLength(o.maxDistance)),t.lengthSq()<o.minDistance*o.minDistance&&a.position.addVectors(u,t.setLength(o.minDistance)))},K=1e-6,L=new THREE.Vector3;u.clone(),a.position.clone(),a.up.clone()}return m.addEventListener("contextmenu",function(a){a.preventDefault()},!1),m.addEventListener("mousedown",e,!1),m.addEventListener("mousewheel",h,!1),m.addEventListener("DOMMouseScroll",h,!1),m.addEventListener("touchstart",i,!1),m.addEventListener("touchend",k,!1),m.addEventListener("touchmove",j,!1),b.addEventListener("keydown",c,!1),b.addEventListener("keyup",d,!1),o.handleResize(),o.update(),o}}(visual||(visual={}));var visual;!function(a){var b=function(){function b(b,c){this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(45,1,.1,1e4);var d=new THREE.AmbientLight(1118481);this.scene.add(d);var e=new THREE.PointLight(16777215);e.position.set(10,10,10),this.scene.add(e);var f=new THREE.DirectionalLight(16777215);f.position.set(0,1,0),this.scene.add(f),this.camera.position.set(4,4,4),this.camera.up.set(0,0,1),this.camera.lookAt(this.scene.position),this.controls=a.trackball(this.camera,b),c?(this.renderer=new THREE.WebGLRenderer({canvas:c}),this.workbench3D=new a.Workbench3D(c,this.renderer,this.camera,this.controls,b)):(this.renderer=new THREE.WebGLRenderer,this.workbench3D=new a.Workbench3D(this.renderer.domElement,this.renderer,this.camera,this.controls,b)),this.renderer.setClearColor(new THREE.Color(526344),1),this.canvas2D=b.document.createElement("canvas"),this.canvas2D.style.position="absolute",this.canvas2D.style.top="0px",this.canvas2D.style.left="0px",this.workbench2D=new a.Workbench2D(this.canvas2D,b),"undefined"!=typeof createjs&&(this.stage=new createjs.Stage(this.canvas2D),this.stage.autoClear=!0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.noZoom=!1,this.controls.noPan=!1,this.controls.staticMoving=!0,this.controls.dynamicDampingFactor=.3,this.controls.keys=[65,83,68]}return b.prototype.add=function(a){this.scene.add(a)},b.prototype.setUp=function(){this.workbench3D.setUp(),this.workbench2D.setUp()},b.prototype.tearDown=function(){this.workbench3D.tearDown(),this.workbench2D.tearDown()},b.prototype.update=function(){this.renderer.render(this.scene,this.camera),this.controls.update(),this.stage&&this.stage.update()},b}();a.Visual=b}(visual||(visual={}));var visual;!function(a){var b=function(a){function b(b,c,d,e,f,g,h){function i(a,b){var c=b%k;if(c===k-1)return i(a,b-1);var d=(b-c)/k;return s*(d+c*t)}function j(a){var b=a%k;return b===k-1?c:d}a.call(this);var k=9;b=b||1,c=c||.08,d=d||.01,e=e||.2,f=f||.8,g=g||8;var l=g*k;h=h||12;for(var m=2*Math.PI,n=b,o=new THREE.Vector3,p=[],q=[],r=f/(e+f),s=m/g,t=r/(k-2),u=0;h>=u;u++)for(var v=m*u/h,w=Math.cos(v),x=Math.sin(v),y=0;l>=y;y++){var z=i(l,y),A=Math.cos(z),B=Math.sin(z);o.x=n*A,o.y=n*B;var C=new THREE.Vector3,D=j(y);C.x=(n+D*w)*A,C.y=(n+D*w)*B,C.z=D*x,this.vertices.push(C),p.push(new THREE.Vector2(y/l,u/h)),q.push(C.clone().sub(o).normalize())}for(var u=1;h>=u;u++)for(var y=1;l>=y;y++){var E=(l+1)*u+y-1,F=(l+1)*(u-1)+y-1,G=(l+1)*(u-1)+y,H=(l+1)*u+y,I=new THREE.Face3(E,F,H,[q[E],q[F],q[H]]);I.normal.add(q[E]),I.normal.add(q[F]),I.normal.add(q[H]),I.normal.normalize(),this.faces.push(I),this.faceVertexUvs[0].push([p[E].clone(),p[F].clone(),p[H].clone()]),I=new THREE.Face3(F,G,H,[q[F],q[G],q[H]]),I.normal.add(q[F]),I.normal.add(q[G]),I.normal.add(q[H]),I.normal.normalize(),this.faces.push(I),this.faceVertexUvs[0].push([p[F].clone(),p[G].clone(),p[H].clone()])}}return __extends(b,a),b}(THREE.Geometry);a.VortexGeometry=b}(visual||(visual={}));var visual;!function(a){var b=function(b){function c(c){c=c||{radius:1,radiusCone:.08,color:16777215,opacity:1,transparent:!1},c.radius=c.radius||1,c.radiusCone=c.radiusCone||.08,c.color="number"==typeof c.color?c.color:16777215,c.opacity="number"==typeof c.opacity?c.opacity:1,c.transparent="boolean"==typeof c.transparent?c.transparent:!1;var d=new THREE.MeshLambertMaterial({color:c.color,opacity:c.opacity,transparent:c.transparent});b.call(this,new a.VortexGeometry(c.radius,c.radiusCone,.01,.02,.075),d)}return __extends(c,b),c}(a.Mesh);a.Vortex=b}(visual||(visual={}));var visual;!function(a){function b(a){return new blade.Euclidean3(a,0,0,0,0,0,0,0)}function c(a,b,c){return new blade.Euclidean3(0,a,b,c,0,0,0,0)}function d(a,b,c){return new blade.Euclidean3(0,0,0,0,a,b,c,0)}function e(a){return new blade.Euclidean3(0,0,0,0,0,0,0,a)}a.VERSION="1.0.0",a.scalarE3=b,a.vectorE3=c,a.bivectorE3=d,a.pseudoE3=e}(visual||(visual={}));