<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/davinci-eight/geometries/ExtrudeSimplexGeometry.ts - davinci-eight</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../../assets/logo.png" title="davinci-eight"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.150.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AbstractMatrix.html">AbstractMatrix</a></li>
                                <li><a href="../classes/AmbientLight.html">AmbientLight</a></li>
                                <li><a href="../classes/ArrowGeometry.html">ArrowGeometry</a></li>
                                <li><a href="../classes/AttribLocation.html">AttribLocation</a></li>
                                <li><a href="../classes/AttribMetaInfo.html">AttribMetaInfo</a></li>
                                <li><a href="../classes/AxialGeometry.html">AxialGeometry</a></li>
                                <li><a href="../classes/AxialSimplexGeometry.html">AxialSimplexGeometry</a></li>
                                <li><a href="../classes/BarnSimplexGeometry.html">BarnSimplexGeometry</a></li>
                                <li><a href="../classes/BlendFactor.html">BlendFactor</a></li>
                                <li><a href="../classes/BoxBuilder.html">BoxBuilder</a></li>
                                <li><a href="../classes/BoxMesh.html">BoxMesh</a></li>
                                <li><a href="../classes/BufferResource.html">BufferResource</a></li>
                                <li><a href="../classes/Canvas3D.html">Canvas3D</a></li>
                                <li><a href="../classes/Capability.html">Capability</a></li>
                                <li><a href="../classes/CartesianE3.html">CartesianE3</a></li>
                                <li><a href="../classes/CC.html">CC</a></li>
                                <li><a href="../classes/Color.html">Color</a></li>
                                <li><a href="../classes/ColorFacet.html">ColorFacet</a></li>
                                <li><a href="../classes/ColorRGB.html">ColorRGB</a></li>
                                <li><a href="../classes/ColorRGBA.html">ColorRGBA</a></li>
                                <li><a href="../classes/ConeGeometry.html">ConeGeometry</a></li>
                                <li><a href="../classes/ConeSimplexGeometry.html">ConeSimplexGeometry</a></li>
                                <li><a href="../classes/ContextAttributesLogger.html">ContextAttributesLogger</a></li>
                                <li><a href="../classes/ContextController.html">ContextController</a></li>
                                <li><a href="../classes/createView.html">createView</a></li>
                                <li><a href="../classes/CuboidGeometry.html">CuboidGeometry</a></li>
                                <li><a href="../classes/CuboidMesh.html">CuboidMesh</a></li>
                                <li><a href="../classes/CuboidSimplexGeometry.html">CuboidSimplexGeometry</a></li>
                                <li><a href="../classes/CurvePath.html">CurvePath</a></li>
                                <li><a href="../classes/CylinderArgs.html">CylinderArgs</a></li>
                                <li><a href="../classes/CylinderGeometry.html">CylinderGeometry</a></li>
                                <li><a href="../classes/CylinderSimplexGeometry.html">CylinderSimplexGeometry</a></li>
                                <li><a href="../classes/Dimensions.html">Dimensions</a></li>
                                <li><a href="../classes/DirectionalLight.html">DirectionalLight</a></li>
                                <li><a href="../classes/Director.html">Director</a></li>
                                <li><a href="../classes/DodecahedronSimplexGeometry.html">DodecahedronSimplexGeometry</a></li>
                                <li><a href="../classes/Drawable.html">Drawable</a></li>
                                <li><a href="../classes/DrawAttribute.html">DrawAttribute</a></li>
                                <li><a href="../classes/DrawMode.html">DrawMode</a></li>
                                <li><a href="../classes/DrawPrimitive.html">DrawPrimitive</a></li>
                                <li><a href="../classes/EIGHTLogger.html">EIGHTLogger</a></li>
                                <li><a href="../classes/ElementArray.html">ElementArray</a></li>
                                <li><a href="../classes/ElementBuffer.html">ElementBuffer</a></li>
                                <li><a href="../classes/EmptyMaterial.html">EmptyMaterial</a></li>
                                <li><a href="../classes/Euclidean1.html">Euclidean1</a></li>
                                <li><a href="../classes/Euclidean2.html">Euclidean2</a></li>
                                <li><a href="../classes/Euclidean3.html">Euclidean3</a></li>
                                <li><a href="../classes/EulerFacet.html">EulerFacet</a></li>
                                <li><a href="../classes/ExtrudeSimplexGeometry.html">ExtrudeSimplexGeometry</a></li>
                                <li><a href="../classes/Face3.html">Face3</a></li>
                                <li><a href="../classes/FontFace.html">FontFace</a></li>
                                <li><a href="../classes/Frustum.html">Frustum</a></li>
                                <li><a href="../classes/G2.html">G2</a></li>
                                <li><a href="../classes/G3.html">G3</a></li>
                                <li><a href="../classes/GeometricE2.html">GeometricE2</a></li>
                                <li><a href="../classes/GeometricE3.html">GeometricE3</a></li>
                                <li><a href="../classes/Geometry.html">Geometry</a></li>
                                <li><a href="../classes/GeometryMeta.html">GeometryMeta</a></li>
                                <li><a href="../classes/Glyph.html">Glyph</a></li>
                                <li><a href="../classes/GridSimplexGeometry.html">GridSimplexGeometry</a></li>
                                <li><a href="../classes/GridTopology.html">GridTopology</a></li>
                                <li><a href="../classes/HTMLScriptsMaterial.html">HTMLScriptsMaterial</a></li>
                                <li><a href="../classes/IAnimation.html">IAnimation</a></li>
                                <li><a href="../classes/IAnimationTarget.html">IAnimationTarget</a></li>
                                <li><a href="../classes/IBufferGeometry.html">IBufferGeometry</a></li>
                                <li><a href="../classes/IContextConsumer.html">IContextConsumer</a></li>
                                <li><a href="../classes/IContextMonitor.html">IContextMonitor</a></li>
                                <li><a href="../classes/IContextProvider.html">IContextProvider</a></li>
                                <li><a href="../classes/IContextRenderer.html">IContextRenderer</a></li>
                                <li><a href="../classes/IcosahedronSimplexGeometry.html">IcosahedronSimplexGeometry</a></li>
                                <li><a href="../classes/IDrawable.html">IDrawable</a></li>
                                <li><a href="../classes/IDrawList.html">IDrawList</a></li>
                                <li><a href="../classes/IFacet
                extends IAnimationTarget
                extends IUnknown.html">IFacet
                extends IAnimationTarget
                extends IUnknown</a></li>
                                <li><a href="../classes/IFacetVisitor.html">IFacetVisitor</a></li>
                                <li><a href="../classes/IMaterial.html">IMaterial</a></li>
                                <li><a href="../classes/IUnknown.html">IUnknown</a></li>
                                <li><a href="../classes/IUnknownArray.html">IUnknownArray</a></li>
                                <li><a href="../classes/IUnknownArray&lt;T extends IUnknown&gt;.html">IUnknownArray&lt;T extends IUnknown&gt;</a></li>
                                <li><a href="../classes/KleinBottleSimplexGeometry.html">KleinBottleSimplexGeometry</a></li>
                                <li><a href="../classes/Line3.html">Line3</a></li>
                                <li><a href="../classes/LineCurve.html">LineCurve</a></li>
                                <li><a href="../classes/LineMaterial.html">LineMaterial</a></li>
                                <li><a href="../classes/LineTopology.html">LineTopology</a></li>
                                <li><a href="../classes/LocalizableMessage.html">LocalizableMessage</a></li>
                                <li><a href="../classes/Material.html">Material</a></li>
                                <li><a href="../classes/Matrix2.html">Matrix2</a></li>
                                <li><a href="../classes/Matrix3.html">Matrix3</a></li>
                                <li><a href="../classes/Matrix4.html">Matrix4</a></li>
                                <li><a href="../classes/Matrix&lt;M&gt;.html">Matrix&lt;M&gt;</a></li>
                                <li><a href="../classes/MeshLambertMaterial.html">MeshLambertMaterial</a></li>
                                <li><a href="../classes/MeshMaterial.html">MeshMaterial</a></li>
                                <li><a href="../classes/MeshTopology.html">MeshTopology</a></li>
                                <li><a href="../classes/ModelE2.html">ModelE2</a></li>
                                <li><a href="../classes/ModelE3.html">ModelE3</a></li>
                                <li><a href="../classes/ModelFacetE3.html">ModelFacetE3</a></li>
                                <li><a href="../classes/Mutable.html">Mutable</a></li>
                                <li><a href="../classes/MutableVector.html">MutableVector</a></li>
                                <li><a href="../classes/NumberIUnknownMap&lt;V&gt;.html">NumberIUnknownMap&lt;V&gt;</a></li>
                                <li><a href="../classes/OcosahedronGeometry.html">OcosahedronGeometry</a></li>
                                <li><a href="../classes/OctahedronSimplexGeometry.html">OctahedronSimplexGeometry</a></li>
                                <li><a href="../classes/Path.html">Path</a></li>
                                <li><a href="../classes/PathArgs.html">PathArgs</a></li>
                                <li><a href="../classes/PathKind.html">PathKind</a></li>
                                <li><a href="../classes/Perspective.html">Perspective</a></li>
                                <li><a href="../classes/PerspectiveCamera.html">PerspectiveCamera</a></li>
                                <li><a href="../classes/Point3.html">Point3</a></li>
                                <li><a href="../classes/PointMaterial.html">PointMaterial</a></li>
                                <li><a href="../classes/PointSize.html">PointSize</a></li>
                                <li><a href="../classes/PointTopology.html">PointTopology</a></li>
                                <li><a href="../classes/PolyhedronSimplexGeometry.html">PolyhedronSimplexGeometry</a></li>
                                <li><a href="../classes/Pseudo.html">Pseudo</a></li>
                                <li><a href="../classes/QQ.html">QQ</a></li>
                                <li><a href="../classes/R1.html">R1</a></li>
                                <li><a href="../classes/R2.html">R2</a></li>
                                <li><a href="../classes/R3.html">R3</a></li>
                                <li><a href="../classes/R4.html">R4</a></li>
                                <li><a href="../classes/RevolutionSimplexGeometry.html">RevolutionSimplexGeometry</a></li>
                                <li><a href="../classes/RigidBodyE2.html">RigidBodyE2</a></li>
                                <li><a href="../classes/RigidBodyE3.html">RigidBodyE3</a></li>
                                <li><a href="../classes/RigidBodyFacetE3.html">RigidBodyFacetE3</a></li>
                                <li><a href="../classes/RingGeometry.html">RingGeometry</a></li>
                                <li><a href="../classes/RingSimplexGeometry.html">RingSimplexGeometry</a></li>
                                <li><a href="../classes/Scalar.html">Scalar</a></li>
                                <li><a href="../classes/Scene.html">Scene</a></li>
                                <li><a href="../classes/ShaderVariableDecl.html">ShaderVariableDecl</a></li>
                                <li><a href="../classes/Shape.html">Shape</a></li>
                                <li><a href="../classes/Shareable.html">Shareable</a></li>
                                <li><a href="../classes/Simplex.html">Simplex</a></li>
                                <li><a href="../classes/Simplex1Geometry.html">Simplex1Geometry</a></li>
                                <li><a href="../classes/SimplexGeometry.html">SimplexGeometry</a></li>
                                <li><a href="../classes/SliceSimplexGeometry.html">SliceSimplexGeometry</a></li>
                                <li><a href="../classes/Slide.html">Slide</a></li>
                                <li><a href="../classes/SmartMaterial.html">SmartMaterial</a></li>
                                <li><a href="../classes/SmartMaterialBuilder.html">SmartMaterialBuilder</a></li>
                                <li><a href="../classes/SphericalPolarSimplexGeometry.html">SphericalPolarSimplexGeometry</a></li>
                                <li><a href="../classes/SpinG2.html">SpinG2</a></li>
                                <li><a href="../classes/SpinG3.html">SpinG3</a></li>
                                <li><a href="../classes/SpinorE1.html">SpinorE1</a></li>
                                <li><a href="../classes/SpinorE2.html">SpinorE2</a></li>
                                <li><a href="../classes/SpinorE3.html">SpinorE3</a></li>
                                <li><a href="../classes/SpinorE4.html">SpinorE4</a></li>
                                <li><a href="../classes/SplineCurve.html">SplineCurve</a></li>
                                <li><a href="../classes/StringIUnknownMap.html">StringIUnknownMap</a></li>
                                <li><a href="../classes/Symbolic.html">Symbolic</a></li>
                                <li><a href="../classes/TetrahedronSimplexGeometry.html">TetrahedronSimplexGeometry</a></li>
                                <li><a href="../classes/Topology.html">Topology</a></li>
                                <li><a href="../classes/UniformLocation.html">UniformLocation</a></li>
                                <li><a href="../classes/UniformMetaInfo.html">UniformMetaInfo</a></li>
                                <li><a href="../classes/Unit.html">Unit</a></li>
                                <li><a href="../classes/Vector.html">Vector</a></li>
                                <li><a href="../classes/Vector3Uniform.html">Vector3Uniform</a></li>
                                <li><a href="../classes/VectorE1.html">VectorE1</a></li>
                                <li><a href="../classes/VectorE2.html">VectorE2</a></li>
                                <li><a href="../classes/VectorE3.html">VectorE3</a></li>
                                <li><a href="../classes/VectorE4.html">VectorE4</a></li>
                                <li><a href="../classes/VectorN&lt;T&gt;.html">VectorN&lt;T&gt;</a></li>
                                <li><a href="../classes/VersionLogger.html">VersionLogger</a></li>
                                <li><a href="../classes/VertexAttributeMap.html">VertexAttributeMap</a></li>
                                <li><a href="../classes/View.html">View</a></li>
                                <li><a href="../classes/VortexSimplexGeometry.html">VortexSimplexGeometry</a></li>
                                <li><a href="../classes/WebGLBlendFunc.html">WebGLBlendFunc</a></li>
                                <li><a href="../classes/WebGLClearColor.html">WebGLClearColor</a></li>
                                <li><a href="../classes/WebGLDisable.html">WebGLDisable</a></li>
                                <li><a href="../classes/WebGLEnable.html">WebGLEnable</a></li>
                                <li><a href="../classes/WindowAnimationRunner.html">WindowAnimationRunner</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/EIGHT.html">EIGHT</a></li>
                                <li><a href="../modules/geometries.html">geometries</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/davinci-eight/geometries/ExtrudeSimplexGeometry.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import Shape = require(&#x27;../geometries/Shape&#x27;)
import SimplexGeometry = require(&#x27;../geometries/SimplexGeometry&#x27;)

/**
 * @class ExtrudeSimplexGeometry
 */
class ExtrudeSimplexGeometry extends SimplexGeometry {
    /**
     * @class ExtrudeSimplexGeometry
     * @constructor
     * @param shapes: [Shape[]=[]]
     * @param options
     * @param type [string=&#x27;ExtrudeSimplexGeometry&#x27;]
     */
    constructor(shapes: Shape[] = [], options: {}, type: string = &#x27;ExtrudeSimplexGeometry&#x27;) {
        super(type)

        this.addShapeList(shapes, options);

        // this.computeFaceNormals();

    }
    /**
     * @method destructor
     * @return {void}
     * @protected
     */
    protected destructor(): void {
        super.destructor()
    }
    addShapeList(shapes: Shape[], options: {}) {
        var sl = shapes.length;

        for (var s = 0; s &lt; sl; s++) {
            var shape = shapes[s];
            this.addShape(shape, options);
        }
    }
    addShape(shape: Shape, options: { amount?: number; bevelEnabled?: boolean; bevelSegments?: number; bevelSize?: number; bevelThickness?: number, curveSegments?: number; steps?: number }) {

        var amount = options.amount !== undefined ? options.amount : 100;

        var bevelThickness = options.bevelThickness !== undefined ? options.bevelThickness : 6; // 10
        var bevelSize = options.bevelSize !== undefined ? options.bevelSize : bevelThickness - 2; // 8
        var bevelSegments = options.bevelSegments !== undefined ? options.bevelSegments : 3;

        var bevelEnabled = options.bevelEnabled !== undefined ? options.bevelEnabled : true; // false

        var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;

        var steps = options.steps !== undefined ? options.steps : 1;

        var extrudePath = options.extrudePath;
        var extrudePts, extrudeByPath = false;

        var material = options.material;
        var extrudeMaterial = options.extrudeMaterial;

        // Use default WorldUVGenerator if no UV generators are specified.
        var uvgen = options.UVGenerator !== undefined ? options.UVGenerator : THREE.ExtrudeGeometry.WorldUVGenerator;

        var splineTube, binormal, normal, position2;
        if (extrudePath) {

            extrudePts = extrudePath.getSpacedPoints(steps);

            extrudeByPath = true;
            bevelEnabled = false; // bevels not supported for path extrusion

            // SETUP TNB variables

            // Reuse TNB from TubeGeomtry for now.
            // TODO1 - have a .isClosed in spline?

            splineTube = options.frames !== undefined ? options.frames : new THREE.TubeGeometry.FrenetFrames(extrudePath, steps, false);

            // console.log(splineTube, &#x27;splineTube&#x27;, splineTube.normals.length, &#x27;steps&#x27;, steps, &#x27;extrudePts&#x27;, extrudePts.length);

            binormal = new THREE.Vector3();
            normal = new THREE.Vector3();
            position2 = new THREE.Vector3();

        }

        // Safeguards if bevels are not enabled

        if (!bevelEnabled) {

            bevelSegments = 0;
            bevelThickness = 0;
            bevelSize = 0;

        }

        // Variables initalization

        var ahole, h, hl; // looping of holes
        var scope = this;

        var shapesOffset = this.vertices.length;

        var shapePoints = shape.extractPoints(curveSegments);

        var vertices = shapePoints.shape;
        var holes = shapePoints.holes;

        var reverse = !isClockWise(vertices);

        if (reverse) {

            vertices = vertices.reverse();

            // Maybe we should also check if holes are in the opposite direction, just to be safe ...

            for (h = 0, hl = holes.length; h &lt; hl; h++) {

                ahole = holes[h];

                if (THREE.Shape.Utils.isClockWise(ahole)) {

                    holes[h] = ahole.reverse();

                }

            }

            reverse = false; // If vertices are in order now, we shouldn&#x27;t need to worry about them again (hopefully)!

        }


        var faces = THREE.Shape.Utils.triangulateShape(vertices, holes);

        /* Vertices */

        var contour = vertices; // vertices has all points but contour has only points of circumference

        for (h = 0, hl = holes.length; h &lt; hl; h++) {

            ahole = holes[h];

            vertices = vertices.concat(ahole);

        }


        function scalePt2(pt, vec, size) {

            if (!vec) THREE.error(&quot;THREE.ExtrudeGeometry: vec does not exist&quot;);

            return vec.clone().multiplyScalar(size).add(pt);

        }

        var b, bs, t, z,
            vert, vlen = vertices.length,
            face, flen = faces.length;


        // Find directions for point movement


        function getBevelVec(inPt, inPrev, inNext) {

            var EPSILON = 0.0000000001;
    
            // computes for inPt the corresponding point inPt&#x27; on a new contour
            //   shiftet by 1 unit (length of normalized vector) to the left
            // if we walk along contour clockwise, this new contour is outside the old one
            //
            // inPt&#x27; is the intersection of the two lines parallel to the two
            //  adjacent edges of inPt at a distance of 1 unit on the left side.
    
            var v_trans_x, v_trans_y, shrink_by = 1;    // resulting translation vector for inPt

            // good reading for geometry algorithms (here: line-line intersection)
            // http://geomalgorithms.com/a05-_intersect-1.html

            var v_prev_x = inPt.x - inPrev.x, v_prev_y = inPt.y - inPrev.y;
            var v_next_x = inNext.x - inPt.x, v_next_y = inNext.y - inPt.y;

            var v_prev_lensq = (v_prev_x * v_prev_x + v_prev_y * v_prev_y);
    
            // check for colinear edges
            var colinear0 = (v_prev_x * v_next_y - v_prev_y * v_next_x);

            if (Math.abs(colinear0) &gt; EPSILON) {    // not colinear
      
                // length of vectors for normalizing
  
                var v_prev_len = Math.sqrt(v_prev_lensq);
                var v_next_len = Math.sqrt(v_next_x * v_next_x + v_next_y * v_next_y);
      
                // shift adjacent points by unit vectors to the left
  
                var ptPrevShift_x = (inPrev.x - v_prev_y / v_prev_len);
                var ptPrevShift_y = (inPrev.y + v_prev_x / v_prev_len);

                var ptNextShift_x = (inNext.x - v_next_y / v_next_len);
                var ptNextShift_y = (inNext.y + v_next_x / v_next_len);
  
                // scaling factor for v_prev to intersection point
  
                var sf = ((ptNextShift_x - ptPrevShift_x) * v_next_y -
                    (ptNextShift_y - ptPrevShift_y) * v_next_x) /
                    (v_prev_x * v_next_y - v_prev_y * v_next_x);
  
                // vector from inPt to intersection point
  
                v_trans_x = (ptPrevShift_x + v_prev_x * sf - inPt.x);
                v_trans_y = (ptPrevShift_y + v_prev_y * sf - inPt.y);
  
                // Don&#x27;t normalize!, otherwise sharp corners become ugly
                //  but prevent crazy spikes
                var v_trans_lensq = (v_trans_x * v_trans_x + v_trans_y * v_trans_y)
                if (v_trans_lensq &lt;= 2) {
                    return new THREE.Vector2(v_trans_x, v_trans_y);
                } else {
                    shrink_by = Math.sqrt(v_trans_lensq / 2);
                }

            } else {    // handle special case of colinear edges

                var direction_eq = false;    // assumes: opposite
                if (v_prev_x &gt; EPSILON) {
                    if (v_next_x &gt; EPSILON) { direction_eq = true; }
                } else {
                    if (v_prev_x &lt; - EPSILON) {
                        if (v_next_x &lt; - EPSILON) { direction_eq = true; }
                    } else {
                        if (Math.sign(v_prev_y) == Math.sign(v_next_y)) { direction_eq = true; }
                    }
                }

                if (direction_eq) {
                    // console.log(&quot;Warning: lines are a straight sequence&quot;);
                    v_trans_x = - v_prev_y;
                    v_trans_y = v_prev_x;
                    shrink_by = Math.sqrt(v_prev_lensq);
                } else {
                    // console.log(&quot;Warning: lines are a straight spike&quot;);
                    v_trans_x = v_prev_x;
                    v_trans_y = v_prev_y;
                    shrink_by = Math.sqrt(v_prev_lensq / 2);
                }

            }

            return new THREE.Vector2(v_trans_x / shrink_by, v_trans_y / shrink_by);

        }


        var contourMovements = [];

        for (var i = 0, il = contour.length, j = il - 1, k = i + 1; i &lt; il; i++ , j++ , k++) {

            if (j === il) j = 0;
            if (k === il) k = 0;

            //  (j)---(i)---(k)
            // console.log(&#x27;i,j,k&#x27;, i, j , k)

            contourMovements[i] = getBevelVec(contour[i], contour[j], contour[k]);

        }

        var holesMovements = [], oneHoleMovements, verticesMovements = contourMovements.concat();

        for (h = 0, hl = holes.length; h &lt; hl; h++) {

            ahole = holes[h];

            oneHoleMovements = [];

            for (i = 0, il = ahole.length, j = il - 1, k = i + 1; i &lt; il; i++ , j++ , k++) {

                if (j === il) j = 0;
                if (k === il) k = 0;

                //  (j)---(i)---(k)
                oneHoleMovements[i] = getBevelVec(ahole[i], ahole[j], ahole[k]);

            }

            holesMovements.push(oneHoleMovements);
            verticesMovements = verticesMovements.concat(oneHoleMovements);

        }


        // Loop bevelSegments, 1 for the front, 1 for the back

        for (b = 0; b &lt; bevelSegments; b++) {
            //for ( b = bevelSegments; b &gt; 0; b -- ) {

            t = b / bevelSegments;
            z = bevelThickness * (1 - t);

            //z = bevelThickness * t;
            bs = bevelSize * (Math.sin(t * Math.PI / 2)); // curved
            //bs = bevelSize * t ; // linear

            // contract shape

            for (i = 0, il = contour.length; i &lt; il; i++) {

                vert = scalePt2(contour[i], contourMovements[i], bs);

                v(vert.x, vert.y, - z);

            }

            // expand holes

            for (h = 0, hl = holes.length; h &lt; hl; h++) {

                ahole = holes[h];
                oneHoleMovements = holesMovements[h];

                for (i = 0, il = ahole.length; i &lt; il; i++) {

                    vert = scalePt2(ahole[i], oneHoleMovements[i], bs);

                    v(vert.x, vert.y, - z);

                }

            }

        }

        bs = bevelSize;

        // Back facing vertices

        for (i = 0; i &lt; vlen; i++) {

            vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];

            if (!extrudeByPath) {

                v(vert.x, vert.y, 0);

            } else {

                // v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );

                normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);
                binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);

                position2.copy(extrudePts[0]).add(normal).add(binormal);

                v(position2.x, position2.y, position2.z);

            }

        }

        // Add stepped vertices...
        // Including front facing vertices

        var s;

        for (s = 1; s &lt;= steps; s++) {

            for (i = 0; i &lt; vlen; i++) {

                vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];

                if (!extrudeByPath) {

                    v(vert.x, vert.y, amount / steps * s);

                } else {

                    // v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );

                    normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);
                    binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);

                    position2.copy(extrudePts[s]).add(normal).add(binormal);

                    v(position2.x, position2.y, position2.z);

                }

            }

        }


        // Add bevel segments planes

        //for ( b = 1; b &lt;= bevelSegments; b ++ ) {
        for (b = bevelSegments - 1; b &gt;= 0; b--) {

            t = b / bevelSegments;
            z = bevelThickness * (1 - t);
            //bs = bevelSize * ( 1-Math.sin ( ( 1 - t ) * Math.PI/2 ) );
            bs = bevelSize * Math.sin(t * Math.PI / 2);

            // contract shape

            for (i = 0, il = contour.length; i &lt; il; i++) {

                vert = scalePt2(contour[i], contourMovements[i], bs);
                v(vert.x, vert.y, amount + z);

            }

            // expand holes

            for (h = 0, hl = holes.length; h &lt; hl; h++) {

                ahole = holes[h];
                oneHoleMovements = holesMovements[h];

                for (i = 0, il = ahole.length; i &lt; il; i++) {

                    vert = scalePt2(ahole[i], oneHoleMovements[i], bs);

                    if (!extrudeByPath) {

                        v(vert.x, vert.y, amount + z);

                    } else {

                        v(vert.x, vert.y + extrudePts[steps - 1].y, extrudePts[steps - 1].x + z);

                    }

                }

            }

        }

        /* Faces */

        // Top and bottom faces

        buildLidFaces();

        // Sides faces

        buildSideFaces();


        /////  Internal functions

        function buildLidFaces() {

            if (bevelEnabled) {

                var layer = 0; // steps + 1
                var offset = vlen * layer;

                // Bottom faces

                for (i = 0; i &lt; flen; i++) {

                    face = faces[i];
                    f3(face[2] + offset, face[1] + offset, face[0] + offset);

                }

                layer = steps + bevelSegments * 2;
                offset = vlen * layer;

                // Top faces

                for (i = 0; i &lt; flen; i++) {

                    face = faces[i];
                    f3(face[0] + offset, face[1] + offset, face[2] + offset);

                }

            } else {

                // Bottom faces

                for (i = 0; i &lt; flen; i++) {

                    face = faces[i];
                    f3(face[2], face[1], face[0]);

                }

                // Top faces

                for (i = 0; i &lt; flen; i++) {

                    face = faces[i];
                    f3(face[0] + vlen * steps, face[1] + vlen * steps, face[2] + vlen * steps);

                }
            }

        }

        // Create faces for the z-sides of the shape

        function buildSideFaces() {

            var layeroffset = 0;
            sidewalls(contour, layeroffset);
            layeroffset += contour.length;

            for (h = 0, hl = holes.length; h &lt; hl; h++) {

                ahole = holes[h];
                sidewalls(ahole, layeroffset);

                //, true
                layeroffset += ahole.length;

            }

        }

        function sidewalls(contour, layeroffset) {

            var j, k;
            i = contour.length;

            while (--i &gt;= 0) {

                j = i;
                k = i - 1;
                if (k &lt; 0) k = contour.length - 1;

                //console.log(&#x27;b&#x27;, i,j, i-1, k,vertices.length);

                var s = 0, sl = steps + bevelSegments * 2;

                for (s = 0; s &lt; sl; s++) {

                    var slen1 = vlen * s;
                    var slen2 = vlen * (s + 1);

                    var a = layeroffset + j + slen1,
                        b = layeroffset + k + slen1,
                        c = layeroffset + k + slen2,
                        d = layeroffset + j + slen2;

                    f4(a, b, c, d, contour, s, sl, j, k);

                }
            }

        }


        function v(x, y, z) {

            scope.vertices.push(new THREE.Vector3(x, y, z));

        }

        function f3(a, b, c) {

            a += shapesOffset;
            b += shapesOffset;
            c += shapesOffset;

            // normal, color, material
            scope.faces.push(new THREE.Face3(a, b, c, null, null, material));

            var uvs = uvgen.generateTopUV(scope, a, b, c);

            scope.faceVertexUvs[0].push(uvs);

        }

        function f4(a, b, c, d, wallContour, stepIndex, stepsLength, contourIndex1, contourIndex2) {

            a += shapesOffset;
            b += shapesOffset;
            c += shapesOffset;
            d += shapesOffset;

            scope.faces.push(new THREE.Face3(a, b, d, null, null, extrudeMaterial));
            scope.faces.push(new THREE.Face3(b, c, d, null, null, extrudeMaterial));

            var uvs = uvgen.generateSideWallUV(scope, a, b, c, d);

            scope.faceVertexUvs[0].push([uvs[0], uvs[1], uvs[3]]);
            scope.faceVertexUvs[0].push([uvs[1], uvs[2], uvs[3]]);

        }

    };

}

export = ExtrudeSimplexGeometry
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
